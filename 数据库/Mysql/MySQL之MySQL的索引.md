# 1. 索引
- 数据库索引，是数据库管理系统中的一个排序的数据结构，以协助快速查询，更新数据库表中的数据
## 1.1. 为什么要使用索引
- 数据是以文件的形式存放在磁盘上面的，每一行数据都有他的磁盘地址，如果没有索引的话，我们要从500万行数据里面检索一条数据，只能一次遍历这张表的全部数据（循环调用存储引擎的读取下一行数据的接口），直到找到这条数据
- 但是我们有了索引之后，只需要在索引里面去检索这条数据就行了，因为它是一种特殊的专门用来快速检索的数据结构，我们找到数据存放的磁盘地址以后，就可以拿到数据了
## 1.2. 索引的类型
### 1.2.1. 普通
- 也叫非唯一索引，是最普通的索引，没有任何限制
### 1.2.2. 唯一
- 唯一索引要求键值不能重复，（主键索引是一种特殊的唯一索引，它还多了一个限制条件，要求键值不能为空）
### 1.2.3. 全文
- 针对比较大的数据，比如我们存放的是消息内容，有几个kb的数据的这种情况，如果要解决like查询效率低的问题，可以创建全文索引，可以创建全文索引，只有文本类型的字段才可以创建全文索引，比如char ,varchar ,text等
（MyISAM和InnoDB都是支持全文索引）
# 2. B+Tree落地形式
![](_v_images/20200610231500203_26952.png =1563x)
- 公有的（每种引擎都会有）就是.frm文件
## 2.1. InnoDB
- 在InnoDB里面，它是以主键为索引来组织数据存储的，所以索引文件和数据文件是在同一个文件，都在.ibd文件里面
- 在InnoDB的主键索引的叶子节点上，它直接存储了我们的数据
- 在InnoDB里面，它组织数据的方式叫做索引组织表，所以主键索引是聚集索引，非主键都是非聚集索引
### 2.1.1. 聚集索引
- 也叫聚簇索引
- 就是索引键值的逻辑顺序跟表数据行的物理存储顺序是一致的
- 在InnoDB中，主键索引和辅助索引也有一个主次之分，辅助索引存储的是辅助索引和主键值，如果使用辅助索引查询，会根据主键值在主键索引中查询，最终取得数据
- 如果一张表没有主键怎么办？
（1）如果我们定义了主键，那么InnoDB会选择主键作为聚集索引
（2）如果没有显示的定义主键，那么InnoDB会选择第一个不包含有NULL值的唯一索引作为主键索引
（3）如果也没有这样的唯一索引，那么InnoDB会选择内置6字节长的rowid作为隐藏的聚集索引，它会随着行记录的写入而主键递增
## 2.2. MyISAM
- 一个就是.MYD文件，D表示Data，是数据文件，存放数据记录
- 一个就是.MYI文件，I代表Index，存放索引
# 3. 索引使用原则
## 3.1. 列的离散度
- 第一个叫做列的离散度，列的全部不同值和所有数据行的比例，数据行数相同的情况下，分子越大，列的离散度就越高
- 如果列的重复值越多，离散度就越低，重复值越少，离散度就越高
## 3.2. 联合索引最左匹配
必须从第一个字段开始，不能跳过
## 3.3. 覆盖索引
- 回表
非主键索引，我们先通过索引找到主键索引的键值，再通过主键值查出索引里面没有的数据，它比基于主键索引的查询多扫描了一颗索引树，这个过程叫做回表
- 覆盖索引
select 的数据列在已经在联合索引中
# 4. 索引的创建与使用
- 在用于where判断 order排序和join的字段上创建索引
- 索引个数不要过多-----浪费空间，更新变慢
- 过长的字段，建议前缀索引
- 区分度低的字段，例如性别，不要建立索引
- 频繁更新的值，不要作为主键或者索引-----页分裂
- 随机无序的值，不建议作为主键索引，例如身份证，UUID
- 组合索引把散列性高的值放在前面
- 创建复合索引，而不是修改单列索引
## 4.1. 什么时候用不到索引
- 索引上使用函数
- 字符串不加引号，出现引式转换
- 大部分like条件前面带%
- 负向查询
- ！=（<>）和not in 在某些情况不可以
其实，用不用索引，最终都是优化器说了算